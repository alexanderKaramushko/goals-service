# goals-mongodb

Сервис управления целями.

## Техническое задание (ТЗ) для проекта "Социальная система целей и сюрпризов"

## 1. Общее описание

Создать веб-приложение, в котором пользователи могут создавать личные цели, назначать промежуточные шаги, а также просматривать цели других пользователей. <br />

Другие пользователи могут создавать сюрпризы за закрытие цели или за достижение целей, а также видеть статистику по баллам и штрафам.

## 2. Основные функции

**2.1 Регистрация и вход**

Пользователь должен иметь возможность зарегистрироваться и войти в систему. <br />
Аутентификация реализуется через JWT либо через сторонние OAuth-провайдеры. <br />

**2.2 Управление целями**

Пользователь может создавать **цель**: название, статус, описание, дата создания, дата выполнения. <br />
Пользователь может создавать промежуточныe шаги у **цели**: описание, дата выполнения. <br />

Пользователь может редактировать или отменить цель. <br />
Отменённая цель считается закрытой с вычетом баллов. <br />

**2.3 Обработка целей**

За выполнение цели пользователь получает звёзды. <br />
За отмену цели — штраф, который вычетает баллы из счета пользователя. <br />

**2.4 Просмотр целей**

Пользователь может просматривать список целей других пользователей. <br />

В списке отображаются:

– Статистика по количеству достигнутых целей и счет баллов;
– Возможность создать **сюрприз** для завершенной цели, если не превышен лимит по просроченным шагам; <br />
– Возможность создать большой сюрприз для другого пользователя, если у него есть нужное кол-во баллов. <br />

**2.5 Создание сюрприза**

Пользователь может создать сюрприз:

– Для закрытой цели другого пользователя, если она будет закрыта без 20% (далее будет детализировано) штрафов; <br />
– За определённое количество полученных баллов за закрытые цели. <br />

**2.6 Статистика и награды**

За выполнение каждой цели пользователь получает баллы (например, +10 баллов). <br />

В профиле отображается: <br />
– Общее число достигнутых целей. <br />
– Общее число полученных баллов. <br />

## 3. Модели данных (примерная структура)

**3.0 Концептуальная модель**

**Сущности**: Пользователь, Цель, Шаг цели, Сюрприз(или Приз).

**ER-диаграмма**:

```mermaid
erDiagram
    USER {
      string id
      string username
      date createdAt
      boolean canAssignSurpise
    }
    TARGET {
      int id
      string userId
      string title
      string description
      string status "CHECK (status IN ('created', 'active', 'completed', 'cancelled'))"
      date shouldBeCompletedAt
      date closedAt
      date createdAt
      date updatedAt
    }
    STEP {
      int id
      int targetId
      string description
      date shouldBeCompletedAt
      date closedAt
      date createdAt
    }
    SURPRISE {
      int id
      int userId
      int targetId
      string description
      date createdAt
      date completedAt
      boolean completed
    }

    USER ||--o| TARGET : creates
    TARGET ||--|{ STEP : has
    TARGET ||--o{ SURPRISE : has
    USER ||--o{ SURPRISE : has
```

**3.1 User (пользователь)**

```json
{
  "id": String,
  "username": String,
  "stars": Number,
  "score": Number,
  "createdAt": Date,
  "canAssignSurpise": boolean,
}
```

**3.2 Target (цель)**

```json
{
  "id": Int,
  "userId": String,
  "title": String,
  "description": String,
  "completedAt": Date,
  "status": String, // "created", "active", "completed", "cancelled"
  "starsEarned": Number,
  "createdAt": Date,
  "updatedAt": Date,
  "cancelledAt": Date,
  "canAssignSurpise": boolean
}
```

**Step (шаг)**

```json
  {
    "id": Int,
    "targetId": Int,
    "description": String,
    "createdAt": Date,
    "completedAt": Date,
    "completed": Boolean
  }
```

**3.3 Surprise (сюрприз)**

```json
{
  "id": Int,
  "userId": Int,
  "targetId": Int, // id цели
  "type": String, // "target" или "stars"
  "message": String,
  "createdAt": Date,
  "isAccepted": Boolean,
  "acceptedAt": Date
}
```

**3.4 Статистика**
Собирается динамически из данных целей, звезд, сюрпризов. <br />

### 4. Логика бизнес-процессов

**Создание цели**: пользователь заходит в систему, создает цель, добавляет шаги и нажимает "Старт". <br />
**Назначение приза к цели**: другой пользователь заходит в систему, добавляет приз к завершенной цели, если она была закрыта без превышения лимитов по штрафам. <br />
**Назначение приза за баллы**: другой пользователь заходит в систему, переходит в профиль пользователя <br />
и создает приз за баллы, у другого пользователя списываются баллы. <br />
**Отмена цели**: пользователь нажимает кнопку "Отменить", фиксируется дата отмены, баллы не начисляются. <br />
**Выполнение шага**: когда наступает дата выполнения шага, то пользователь должен записать итог шага и пометить его как выполненный. <br />
**Получение наград**: после достижения цели пользователю начисляются баллы, обновляются параметры пользователя. <br />

### 5. Технические требования

Backend: NestJS с использованием MongoDB. <br />
Аутентификация: JWT либо сторонние OAuth-провайдеры. <br />
API: RESTful или GraphQL (выберите по желанию). <br />
Безопасность: защита эндпоинтов, проверка прав доступа. <br />
Миграции/обновление схем: при необходимости. <br />

### 6. Дополнительные требования

Возможность просмотра списка целей в ЛК. <br />
Возможность баллов в ЛК. <br />
Фильтрация целей по статусу, дате, автору. <br />
